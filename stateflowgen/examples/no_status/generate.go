// Code generated by gogen. DO NOT EDIT.
package no_status

import "errors"

// ================ stateflow ================

// æµç¨‹å›¾ï¼š
// ```
//                          â”Œâ”€â”€â–¶ Completed
//                          â”‚
// Pending â”€â”€â–¶ Processing â”€â”€â”¤
//                          â”‚
//                          â””â”€â”€â–¶ Failed â”€â”€â–¶ Processing ğŸ”
// ```

// PaymentPhase é˜¶æ®µæšä¸¾
type PaymentPhase string

const (
	PaymentPhasePending    PaymentPhase = "Pending"
	PaymentPhaseProcessing PaymentPhase = "Processing"
	PaymentPhaseCompleted  PaymentPhase = "Completed"
	PaymentPhaseFailed     PaymentPhase = "Failed"
)

var PaymentPhaseEnums = struct {
	Pending    PaymentPhase
	Processing PaymentPhase
	Completed  PaymentPhase
	Failed     PaymentPhase
}{
	Pending:    PaymentPhasePending,
	Processing: PaymentPhaseProcessing,
	Completed:  PaymentPhaseCompleted,
	Failed:     PaymentPhaseFailed,
}

// PaymentStage é˜¶æ®µï¼ˆPhase + Statusï¼‰
type PaymentStage = PaymentPhase

// é¢„å®šä¹‰é˜¶æ®µ
var (
	StagePaymentPending    = PaymentPhasePending
	StagePaymentProcessing = PaymentPhaseProcessing
	StagePaymentCompleted  = PaymentPhaseCompleted
	StagePaymentFailed     = PaymentPhaseFailed
)

// PaymentState å®Œæ•´çŠ¶æ€
type PaymentState struct {
	Current PaymentStage `json:"current"`
}

// PaymentStateColumns æ•°æ®åº“å­˜å‚¨ç»“æ„
type PaymentStateColumns struct {
	Phase PaymentPhase `gorm:"column:phase" json:"phase"`
}

func (s PaymentState) ToColumns() PaymentStateColumns {
	return PaymentStateColumns{
		Phase: s.Current,
	}
}

func (c PaymentStateColumns) ToState() PaymentState {
	return PaymentState{
		Current: c.Phase,
	}
}

// é”™è¯¯å®šä¹‰
var ErrPaymentInvalidTransition = errors.New("invalid transition")

func (s PaymentState) TransitionTo(to PaymentStage) (PaymentState, error) {
	switch s.Current {
	case StagePaymentPending:
		switch to {
		case StagePaymentProcessing:
			return PaymentState{Current: to}, nil
		}
	case StagePaymentProcessing:
		switch to {
		case StagePaymentCompleted:
			return PaymentState{Current: to}, nil
		case StagePaymentFailed:
			return PaymentState{Current: to}, nil
		}
	case StagePaymentFailed:
		switch to {
		case StagePaymentProcessing:
			return PaymentState{Current: to}, nil
		}
	}
	return s, ErrPaymentInvalidTransition
}

func (s PaymentState) ValidTransitions() []PaymentStage {
	switch s.Current {
	case StagePaymentPending:
		return []PaymentStage{StagePaymentProcessing}
	case StagePaymentProcessing:
		return []PaymentStage{StagePaymentCompleted, StagePaymentFailed}
	case StagePaymentFailed:
		return []PaymentStage{StagePaymentProcessing}
	}
	return nil
}
