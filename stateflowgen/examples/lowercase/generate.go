// Code generated by gogen. DO NOT EDIT.
package lowercase

import "errors"

// ================ stateflow ================

// æµç¨‹å›¾ï¼š
// ```
//                    â”Œâ”€â”€â–¶ resolved â”€â”€â–¶ closed
//                    â”‚
// open â”€â”€â–¶ pending â”€â”€â”¤
//                    â”‚
//                    â””â”€â”€â–¶ rejected â”€â”€â–¶ open ğŸ”
// ```

// TicketPhase é˜¶æ®µæšä¸¾
type TicketPhase string

const (
	TicketPhaseOpen     TicketPhase = "open"
	TicketPhasePending  TicketPhase = "pending"
	TicketPhaseResolved TicketPhase = "resolved"
	TicketPhaseRejected TicketPhase = "rejected"
	TicketPhaseClosed   TicketPhase = "closed"
)

var TicketPhaseEnums = struct {
	Open     TicketPhase
	Pending  TicketPhase
	Resolved TicketPhase
	Rejected TicketPhase
	Closed   TicketPhase
}{
	Open:     TicketPhaseOpen,
	Pending:  TicketPhasePending,
	Resolved: TicketPhaseResolved,
	Rejected: TicketPhaseRejected,
	Closed:   TicketPhaseClosed,
}

// TicketStage é˜¶æ®µï¼ˆPhase + Statusï¼‰
type TicketStage = TicketPhase

// é¢„å®šä¹‰é˜¶æ®µ
var (
	StageTicketOpen     = TicketPhaseOpen
	StageTicketPending  = TicketPhasePending
	StageTicketResolved = TicketPhaseResolved
	StageTicketRejected = TicketPhaseRejected
	StageTicketClosed   = TicketPhaseClosed
)

// TicketState å®Œæ•´çŠ¶æ€
type TicketState struct {
	Current TicketStage `json:"current"`
}

// TicketStateColumns æ•°æ®åº“å­˜å‚¨ç»“æ„
type TicketStateColumns struct {
	Phase TicketPhase `gorm:"column:phase" json:"phase"`
}

func (s TicketState) ToColumns() TicketStateColumns {
	return TicketStateColumns{
		Phase: s.Current,
	}
}

func (c TicketStateColumns) ToState() TicketState {
	return TicketState{
		Current: c.Phase,
	}
}

// é”™è¯¯å®šä¹‰
var ErrTicketInvalidTransition = errors.New("invalid transition")

func (s TicketState) TransitionTo(to TicketStage) (TicketState, error) {
	switch s.Current {
	case StageTicketOpen:
		switch to {
		case StageTicketPending:
			return TicketState{Current: to}, nil
		}
	case StageTicketPending:
		switch to {
		case StageTicketResolved:
			return TicketState{Current: to}, nil
		case StageTicketRejected:
			return TicketState{Current: to}, nil
		}
	case StageTicketResolved:
		switch to {
		case StageTicketClosed:
			return TicketState{Current: to}, nil
		}
	case StageTicketRejected:
		switch to {
		case StageTicketOpen:
			return TicketState{Current: to}, nil
		}
	}
	return s, ErrTicketInvalidTransition
}

func (s TicketState) ValidTransitions() []TicketStage {
	switch s.Current {
	case StageTicketOpen:
		return []TicketStage{StageTicketPending}
	case StageTicketPending:
		return []TicketStage{StageTicketResolved, StageTicketRejected}
	case StageTicketResolved:
		return []TicketStage{StageTicketClosed}
	case StageTicketRejected:
		return []TicketStage{StageTicketOpen}
	}
	return nil
}
