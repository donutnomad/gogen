// Code generated by gogen. DO NOT EDIT.
package no_name

import "errors"

// ================ stateflow ================

// æµç¨‹å›¾ï¼š
// ```
//           â”Œâ”€â”€â–¶ approved â”€â”€â–¶ done
//           â”‚
// pending â”€â”€â”¤
//           â”‚
//           â””â”€â”€â–¶ rejected â”€â”€â–¶ pending ğŸ”
// ```

// Phase é˜¶æ®µæšä¸¾
type Phase string

const (
	PhasePending  Phase = "pending"
	PhaseApproved Phase = "approved"
	PhaseRejected Phase = "rejected"
	PhaseDone     Phase = "done"
)

var PhaseEnums = struct {
	Pending  Phase
	Approved Phase
	Rejected Phase
	Done     Phase
}{
	Pending:  PhasePending,
	Approved: PhaseApproved,
	Rejected: PhaseRejected,
	Done:     PhaseDone,
}

// Stage é˜¶æ®µï¼ˆPhase + Statusï¼‰
type Stage = Phase

// é¢„å®šä¹‰é˜¶æ®µ
var (
	StagePending  = PhasePending
	StageApproved = PhaseApproved
	StageRejected = PhaseRejected
	StageDone     = PhaseDone
)

// State å®Œæ•´çŠ¶æ€
type State struct {
	Current Stage `json:"current"`
}

// StateColumns æ•°æ®åº“å­˜å‚¨ç»“æ„
type StateColumns struct {
	Phase Phase `gorm:"column:phase" json:"phase"`
}

func (s State) ToColumns() StateColumns {
	return StateColumns{
		Phase: s.Current,
	}
}

func (c StateColumns) ToState() State {
	return State{
		Current: c.Phase,
	}
}

// é”™è¯¯å®šä¹‰
var ErrInvalidTransition = errors.New("invalid transition")

func (s State) TransitionTo(to Stage) (State, error) {
	switch s.Current {
	case StagePending:
		switch to {
		case StageApproved:
			return State{Current: to}, nil
		case StageRejected:
			return State{Current: to}, nil
		}
	case StageApproved:
		switch to {
		case StageDone:
			return State{Current: to}, nil
		}
	case StageRejected:
		switch to {
		case StagePending:
			return State{Current: to}, nil
		}
	}
	return s, ErrInvalidTransition
}

func (s State) ValidTransitions() []Stage {
	switch s.Current {
	case StagePending:
		return []Stage{StageApproved, StageRejected}
	case StageApproved:
		return []Stage{StageDone}
	case StageRejected:
		return []Stage{StagePending}
	}
	return nil
}
